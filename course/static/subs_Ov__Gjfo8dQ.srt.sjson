{"start":[0,1730,4050,5490,8905,10980,13777,16660,18420,19620,21230,25700,28840,30238,33480,36280,41220,47620,51050,53030,55740,58730,61670,69435,70610,73310,74885,76820,79655,81895,84260,86435,88385,93715,96350,97955,99305,101280,103205,104580,106235,108120,111750,114645,118140,122610,127757,132495,135870,138755,140215,141810,143290,144860,147465,149055,151290,154070,155355,156360,157470,161160,165819,167945,171640,171820,173360,175575,177080,178505,180590,184430,185720,188315,190640,192800,196453,198050,200625,201815,205700,206570,207910,208670,210010,211760,214700,217250,220505,223385,225020,227705,230720,233745,236660,237950,240045,242615,243860,244995,247820,248035,251715,255515,261200,261490,264665,268480,271440,275480,282425,288285,293110,296870,300775,302110,305740,307035,309295,311920,315975,317710,320335,325850,329245,332389,334000,335693,337195,339815,341610,345149,347180,350125,352420,356055,360446,363320,366640,368200,369120,371065,373825,379165,381130,385035,387426,389770,392455,394970,397450,400150,402985,404525,407115,409120,411775,413965,418120,419860,421720,423700,426175,427540,429230,429285,430510,432185,436078,438660,441340,444345,445990,449350,450380,451900,453010,454810,455042,457545,459580,462425,463990,465910,468130,470915,476560,479780,482185,484345,486100,488980,491595,493000,495065,497215,499885,502030,504790,507160,510415,512890,515775,518645,521864,524410,527730,529725,531230,533870,536090,539150,540710,542780,543875,546770,549308,551840,553520,556010,557510,560930,564590,569630,572445,573830,576296,578090,580625,583535,585200,586785,590535,593060,596810,599060,601280,602750,605030,606795,608275,610090,613670,615905,617720],"end":[1730,4050,5490,8905,10980,13777,16660,18420,19620,21230,25700,28840,30238,33480,36280,41220,47620,51050,53030,55740,58730,61670,69435,70610,73310,74885,76820,79655,81895,84260,86435,88385,93715,96350,97955,99305,101280,103205,104580,106235,108120,111750,114645,118140,122610,127757,132495,135870,138755,140215,141810,143290,144860,147465,149055,151290,154070,155355,156360,157470,161160,165819,167945,171640,171820,173360,175575,177080,178505,180590,184430,185720,188315,190640,192800,196453,198050,200625,201815,205700,206570,207910,208670,210010,211760,214700,217250,220505,223385,225020,227705,230720,233745,236660,237950,240045,242615,243860,244995,247820,248035,251715,255515,261200,261490,264665,268480,271440,275480,282425,288285,293110,296870,300775,302110,305740,307035,309295,311920,315975,317710,320335,325850,329245,332389,334000,335693,337195,339815,341610,345149,347180,350125,352420,356055,360446,363320,366640,368200,369120,371065,373825,379165,381130,385035,387426,389770,392455,394970,397450,400150,402985,404525,407115,409120,411775,413965,418120,419860,421720,423700,426175,427540,429230,429285,430510,432185,436078,438660,441340,444345,445990,449350,450380,451900,453010,454810,455042,457545,459580,462425,463990,465910,468130,470915,476560,479780,482185,484345,486100,488980,491595,493000,495065,497215,499885,502030,504790,507160,510415,512890,515775,518645,521864,524410,527730,529725,531230,533870,536090,539150,540710,542780,543875,546770,549308,551840,553520,556010,557510,560930,564590,569630,572445,573830,576296,578090,580625,583535,585200,586785,590535,593060,596810,599060,601280,602750,605030,606795,608275,610090,613670,615905,617720,620750],"text":[">> So Andrew, I heard a lot about","Cosmos DB and the consistency levels,","how they're tuneable and how that's","a big part of your performance guarantees,","the customization that people could do on a daily basis.","I want to learn more about that. What options we have and","how it affects our database or maybe our application,","and why we should consider","the different consistency levels","and not just leave it at the default.",">> Yes. So, let's first start with some context.","So consistency is all anchored around replication.","And so, let's actually put","a little example set up here for our database.","Let's say we started off in East US,","and we're also replicating in the cloud to","North Europe and maybe, West US.","Now, the topology for Cosmos DB is","every single one of these partitions is actually","replicated four ways in each region.","And so, think of it as we have a set","of four replicas in each of","these regions and through this,","this is actually how we gave you","such degree of high redundancy,","so that we're able to offer","rock solid availability as always,","even for a single region deployment.","If let's say, one of these replicas were to go down,","we'll automatically do leader election,","we'll automatically reboot, sharpen new replica.","All of these happened behind the scenes.","What you see as a user is just rock solid availability.","And what ends up happening is we also have to","replicate all of this data","across these different regions,","the ones that you have chosen, right?","And this is where consistency comes in,","because if I were to let's say,","do a database writes.","Let's say, I want to update a value from","two to three and over here,","first I have two and this information of","updating this value two to three is propagating over.","So let's say we have an observer here and he's pulling","the database and he wants to see what this value is.","This is kind of where consistency comes in.","What happens is in order for","this data to actually propagate all the way to the user,","he has to wait a while and","if he wants a strong consistency,","if he wants to be guaranteed that you","will see the value of three,","and that he doesn't have a still read request.","On the other hand,","he might want to just immediately get","this value and just return.","And so,","let's talk about also some of","the scenarios that relate in","this space for a strong consistency","and eventual consistency.","As an example scenario for","strong consistency is an order payment processing system.",">> Sure.",">> Let's say, I have an e-commerce system","and I have a bunch of orders coming in.","If I were to get a still read,","let's say I'm going to update","a record from pending payment","to a processed payment and what the application does is,","it looks for everything that is","pending and process them for payment.","If they get to still read in this example,","what will happen is you'll accidentally charge","the order twice or maybe more,","some number more than once.","Depending on how many still read requests it gets.","And at the end of the day,","you end up with a very unhappy customer who goes,","\"Hey why did he charge","me five times for this one order?\".",">> Exactly.",">> So, in that scenario you want","something that's strong consistency.","On the other hand, for eventual consistency,","imagine social media application.","If I'm going into something like Facebook.com,","and I'm just going to go and look at your wall posts.","What's important for me is actually,","the website is very very snappy, right?","So, what I want is the page to","load quickly and if I see Sidney's comment,","a second later the next refresh if I get a still read,","that's actually okay for me.","All I want to make sure is the website","actually loads very very in a fast performance manner.",">> So, you're talking about here","on this and into the graph,","the data's going to eventually be consistent.",">> Yes.",">> With the primary, but may not instantly be consistent.",">> Yes. And the thing is that these are","very strong like black and white, like extremes.",">> Right.",">> On the type of consistencies,","you can actually observe on a database.","And so, there's actually some nice shades of gray.","Some nice click stops in between that we expose including","Bounded Staleness Session","and consistent prefix.","And the way you can think of this is,","given that these are different consistency levels,","lets go from weakest to strongest consistency,","to kind of give you an idea","of why I would choose one over the other.",">> Sure.",">> Starting from eventual consistency,","when writes come into the database they might be","replicated asynchronously to other regions and any order.","And so, if I were to write","a messaging application let's say,","were discussing lets go grab dinner, me and you Sidney.","And if I say, \"Hey do you want to do dinner tonight?","What are you in the mood for?\"","You might tell me, \"Oh,","Andrew I really love Italian food,","what time works best?\"","And I say, \"How about 7 pm?\"","And then lets say you say, \"Oh,","I'm busy at 7 or I'm busy,","what about another time?\"","And I say, \"How about 8pm?\" And you say, \"Okay.\"","If I replicate these in","any order and they get flushed to another replica,","I might actually see out of order, right?","Get propagated it over and if I swap eight and seven,","I'm going to arrive at the wrong time of day.","And we're going to be kind of confused like,","\"Hey, where did Sydney go?","I thought we we're going to grab dinner together.\"","And so this is actually what consistent prefix comes in.","Replication always happens in order and as a result,","if you work the right database operations.","Let's say, one, two, three, four, five,","if the replicas caught up to four,","what it'll do you is it will show you one, two,","three, four, in order without any gaps.","Whereas if I had one, two, three, four,","or five as database operations and","eventual consistency it's possible that one,","three, and five got replicated.","Two and four are missing and","five and three might actually be swapped.","And so the consistent prefix basically,","guarantees in order replication.","And as a result you always","have no gaps in the data and it's always in order.","Now, we can strengthen that further.","For session consistency, this is actually","the idea of getting","strong consistency within the scope of a session","and eventual consistency","outside of the scope of that session.",">>Okay.",">> And so, let's actually go","back to the social media example.","And if I were to write a comment,","now it's okay for you to get a still read,","because you just want a fast web experience.","However, if I refresh the page and my comment disappears,","I'm going to be kind of confused like, \"Hey,","did my comment actually go to the database or not?\"","Maybe I'll write it again and","refresh and now appears twice.",">> So, you're talking about the classic","double post scenario there?",">> Yes.",">> Other people maybe eventually consistent,","but I need to be absolutely","strongly consistent on my individual session.",">> Yes. And so this way you can","actually have a much better user experience","where if a write comes into the database at","least you're always able to observe your own writes.","And so this is the whole concept of read your own writes.","In that way you're","not paying a performance penalty","for strong consistency across the board,","you're actually minimizing","that performance penalty by only","scoping consistency to your session and always being","about observe the writes that","you have within your own session.","Now, Bounded Staleness is about","how eventual is eventual consistency?","Can we actually put some bounds in and","guarantee that replicas we're not","lag behind by a number","of operations or by a set amount of time.","And so, we actually let you define these bounds,","time, and number of operations.","And what we'll do is","if either of these bounds are ever met,","in the general case, they won't be.","But let's say in the unhappy case that this actually,","the replica starts to lag behind.","What we can do on our end is we can actually","start prioritizing replication and","apply back pressure on the right path as","needed to force replicas to catch up.","And then of course, if you strengthen","that further you have strong consistency.","The main thing to note is","consistency doesn't come for free.","While you get stronger consistency,","what that means is that if you think about how","the database is actually","operating in order to get that consistency,","you are actually now having","to propagate data everywhere and you have","basically a huge latency as well as a huge hit on","throughput in the happy case throughput.","And the common case scenario","for a strong and bounded staleness,","in order to implement this on our end,","what we'll have to do is we have to do a quorum raids","across a set number of replicas.","Meaning that the RU cost","of each independent read operation","is going to be amplified.","Furthermore, the latency is going to be a bit higher.","And so depending on what the performance","versus consistency trade-off that you would like,","what makes sense for your application","and your personal scenario.","We give you a lot of flexibility in","choosing which one to implement.",">> And I'll tell you this is really interesting.","Lots of different options.","So, we can decide how we wanted to tune","the consistency for different data base and basically map","it to the application we have","and choose an option that makes","sense for our application, our data base workload."]}